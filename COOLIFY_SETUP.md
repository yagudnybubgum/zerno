# Настройка переменных окружения в Coolify

## Проблема
После деплоя показывается ошибка "Требуется настройка Supabase" - это значит, что переменные окружения не настроены в Coolify.

## Решение

### Шаг 1: Получите ключи из Supabase

1. Откройте панель Supabase: https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в **Settings** → **API**
4. Скопируйте следующие значения:
   - **Project URL** (например: `https://xxxxx.supabase.co`)
   - **anon public** key (длинная строка, начинается с `eyJ...`)
   - **service_role** key (длинная строка, начинается с `eyJ...`) - ⚠️ **НЕ ДЕЛИТЕСЬ ЭТИМ КЛЮЧОМ!**

### Шаг 2: Настройте переменные окружения в Coolify

1. Откройте панель Coolify
2. Найдите ваше приложение
3. Перейдите в настройки приложения (Settings / Environment Variables)
4. Добавьте следующие переменные окружения:

```
NEXT_PUBLIC_SUPABASE_URL=https://ваш-проект.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=ваш_anon_key_здесь
SUPABASE_SERVICE_ROLE_KEY=ваш_service_role_key_здесь
ADMIN_EMAILS=ваш@email.com
```

**Важно:**
- Замените `https://ваш-проект.supabase.co` на реальный URL из Supabase
- Замените `ваш_anon_key_здесь` на реальный anon key
- Замените `ваш_service_role_key_здесь` на реальный service_role key
- В `ADMIN_EMAILS` укажите email, который будете использовать для регистрации (через запятую, если несколько)

### Шаг 3: Создайте Storage bucket в Supabase

1. В панели Supabase перейдите в **Storage**
2. Нажмите **Create bucket**
3. Заполните:
   - **Name**: `lot-images`
   - **Public bucket**: ✅ включите (чтобы изображения были доступны публично)
4. Нажмите **Create bucket**

### Шаг 4: Настройте политики Storage (опционально)

Если bucket не публичный, выполните в SQL Editor:

1. Откройте **SQL Editor** → **New query**
2. Откройте файл `supabase/storage.sql` из проекта
3. Скопируйте содержимое
4. Вставьте в SQL Editor и выполните

### Шаг 5: Перезапустите приложение в Coolify

1. После добавления переменных окружения
2. Нажмите **Redeploy** или перезапустите приложение
3. Дождитесь завершения деплоя

### Шаг 6: Проверка

После перезапуска:
- Откройте сайт
- Должна отображаться страница "Каталог кофе" вместо ошибки
- Попробуйте зарегистрироваться и войти

## Проверка переменных окружения

Убедитесь, что все переменные добавлены:

- ✅ `NEXT_PUBLIC_SUPABASE_URL` - URL проекта Supabase
- ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY` - anon public key
- ✅ `SUPABASE_SERVICE_ROLE_KEY` - service_role key
- ✅ `ADMIN_EMAILS` - email адреса админов (через запятую)

## Если ошибка все еще есть

1. **Проверьте формат переменных:**
   - URL должен начинаться с `https://` и содержать `.supabase.co`
   - Ключи должны быть длинными строками (обычно > 100 символов)

2. **Проверьте, что переменные сохранены:**
   - В Coolify переменные должны быть видны в списке
   - Убедитесь, что нет лишних пробелов или кавычек

3. **Проверьте логи приложения:**
   - В Coolify откройте логи приложения
   - Ищите ошибки связанные с Supabase

4. **Проверьте Storage bucket:**
   - Убедитесь, что bucket `lot-images` создан
   - Проверьте, что он публичный или политики настроены

