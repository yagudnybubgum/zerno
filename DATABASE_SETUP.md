# Настройка базы данных Supabase

## Проблема
База данных не загружается автоматически. Нужно вручную применить схему в Supabase.

## Решение

### Вариант 1: Через SQL Editor (Рекомендуется)

1. **Откройте панель Supabase:**
   - Перейдите на https://supabase.com/dashboard
   - Выберите ваш проект

2. **Откройте SQL Editor:**
   - В левом меню нажмите **SQL Editor**
   - Нажмите **New query**

3. **Примените схему БД:**
   - Откройте файл `supabase/schema.sql` из этого проекта
   - Скопируйте **весь** содержимое файла
   - Вставьте в SQL Editor
   - Нажмите **Run** (или `Ctrl+Enter` / `Cmd+Enter`)
   - Должно появиться сообщение "Success. No rows returned"

4. **Создайте Storage bucket:**
   - Перейдите в **Storage** в левом меню
   - Нажмите **Create bucket**
   - Имя: `lot-images`
   - Включите **Public bucket** ✅ (рекомендуется)
   - Нажмите **Create bucket**

5. **Настройте политики Storage:**
   - Откройте **SQL Editor** → **New query**
   - Откройте файл `supabase/storage.sql` из этого проекта
   - Скопируйте содержимое
   - Вставьте в SQL Editor и выполните
   - Или настройте политики вручную через **Storage** → **Policies**

### Вариант 2: Через Supabase CLI (для продвинутых)

Если у вас установлен Supabase CLI:

```bash
# Установка CLI (если не установлен)
npm install -g supabase

# Логин
supabase login

# Связывание с проектом
supabase link --project-ref ваш-project-ref

# Применение миграций
supabase db push
```

## Проверка

После применения схемы проверьте:

1. **Таблицы созданы:**
   - Перейдите в **Table Editor**
   - Должны быть таблицы: `profiles`, `lots`, `reviews`

2. **View создан:**
   - В **SQL Editor** выполните:
   ```sql
   SELECT * FROM lots_with_rating LIMIT 1;
   ```
   - Должно вернуться без ошибок

3. **Storage работает:**
   - Перейдите в **Storage** → **lot-images**
   - Должен быть создан bucket

## Опционально: Добавление тестовых данных

Если хотите добавить тестовые данные:

1. Откройте **SQL Editor**
2. Откройте файл `supabase/seed.sql`
3. Скопируйте содержимое
4. Вставьте в SQL Editor и выполните

## Важные замечания

- ⚠️ **RLS (Row Level Security) включен** - это нормально, политики настроены в schema.sql
- ⚠️ **Storage bucket должен быть публичным** для загрузки изображений
- ⚠️ **Не удаляйте таблицы вручную** - используйте SQL миграции

## Если что-то пошло не так

1. **Ошибка при создании таблиц:**
   - Проверьте, что вы скопировали весь файл `schema.sql`
   - Убедитесь, что нет синтаксических ошибок

2. **Ошибка "relation already exists":**
   - Таблицы уже созданы, это нормально
   - Пропустите создание и перейдите к следующему шагу

3. **Storage не работает:**
   - Убедитесь, что bucket `lot-images` создан
   - Проверьте, что bucket публичный или политики настроены

